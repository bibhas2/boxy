<!DOCTYPE html>
<html>
  <head>
    <title>Boxy</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="../css/photon.min.css">
    <script src="../bower_components/angular/angular.min.js"></script>
    <link rel="stylesheet" href="../node_modules/highlight.js/styles/tomorrow.css">
    <!-- <script src="../node_modules/highlight.js/lib/highlight.js"></script>
    <script src="../node_modules/highlight.js/lib/languages/json.js"></script>
    <script src="../node_modules/highlight.js/lib/languages/xml.js"></script> -->
    <script src="js/boxy.js" charset="utf-8"></script>
    <style>
    dialog {
      padding: 0;
      border: 1px solid #bebebe;
      border-radius: 6px;
      box-shadow: 0 0 30px rgba(0,0,0,.1);
      overflow: hidden;
      width:400px;
      &::backdrop {
          background: rgba(0,0,0,0.2);
      }
    }
    tr.selected {
      color: #fff;
      background-color: #116cd6;
    }
    code {
      font-weight: bold;
      font-size: 14pt;
    }
    </style>
  </head>
  <body ng-app="BoxyApp" ng-controller="MainController as main">
    <div class="window">

      <!-- .toolbar-header sits at the top of your app -->
      <!-- <header class="toolbar toolbar-header">
        <h1 class="title">Photon</h1>
      </header> -->

      <!-- Your app's content goes inside .window-content -->
      <div class="window-content">
        <div class="pane-group">
          <div class="pane pane-sm sidebar">
            <header class="toolbar toolbar-header">
              <div class="toolbar-actions">
                <div class="btn-group">
                  <button class="btn btn-default" title="Add a new server" ng-click="main.openNewServerDialog()">
                    <span class="icon icon-plus"></span>
                  </button>
                  <button class="btn btn-default" title="Remove the server" ng-if="main.selectedServer !== undefined" ng-click="main.removeServer()">
                    <span class="icon icon-minus"></span>
                  </button>
                  <button class="btn btn-default" title="Edit the server settings" ng-if="main.selectedServer !== undefined" ng-click="main.openEditServerDialog()">
                    <span class="icon icon-pencil"></span>
                  </button>
                  <button class="btn btn-default" title="Start the server" ng-if="main.startButtonEnabled()" ng-click="main.startServer()">
                    <span class="icon icon-play" style="color: #34c84a"></span>
                  </button>
                  <button class="btn btn-default" title="Stop the server" ng-if="main.stopButtonEnabled()" ng-click="main.stopServer()">
                    <span class="icon icon-stop" style="color: #fc605b"></span>
                  </button>
                </div>
              <div>
            </header>
            <nav class="nav-group">
              <h5 class="nav-group-title">Servers</h5>
              <span class="nav-group-item" ng-repeat="server in main.serverList" ng-click="main.selectServer(server)" ng-dblclick="main.openEditServerDialog()" ng-class="{active: main.isServerSelected(server)}">
                <span class="icon icon-record" ng-style="{color: server.started ? '#34c84a' : '#fc605b'}"></span>
                {{server.name}}
              </span>
            </nav>
          </div>

          <div class="pane" style="height:100%">
            <div style="height:35%;overflow-y:auto">
              <table __class="table-striped">
                <thead>
                  <tr>
                    <th width="20%">When</th>
                    <th width="50%">Path</th>
                    <th width="15%">Status</th>
                    <th width="15%">Response Time (ms)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="req in main.selectedServer.requestList" ng-click="main.selectRequest(req)" ng-class="{selected: main.isRequestSelected(req)}">
                    <td>{{req.formattedStartTime}}</td>
                    <td>{{req.request.url}}</td>
                    <td>{{req.response.statusCode}}</td>
                    <td>{{req.duration}}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div style="height:65%">

              <header class="toolbar toolbar-header">

                <div class="tab-group">
                  <div class="tab-item" ng-click="main.activeTab = 'request'" ng-class="{active: main.activeTab == 'request'}">
                    Request
                  </div>
                  <div class="tab-item" ng-click="main.activeTab = 'response'" ng-class="{active: main.activeTab == 'response'}">
                    Response
                  </div>
                </div>

                <div class="toolbar-actions" align="center">
                  <div class="btn-group" ng-if="main.activeTab == 'request'">
                    <button class="btn btn-default" ng-class="{active: main.requestBodyFormat == 'pretty'}" title="Show formatted body" ng-click="main.setRequestBodyFormat('pretty')">
                      <span class="icon icon-list"></span> &nbsp;Pretty
                    </button>
                    <button class="btn btn-default" ng-class="{active: main.requestBodyFormat == 'raw'}" title="Show raw body" ng-click="main.setRequestBodyFormat('raw')">
                      <span class="icon icon-tools"></span> &nbsp;Raw
                    </button>
                  </div>
                  <div class="btn-group" ng-if="main.activeTab == 'response'">
                    <button class="btn btn-default" ng-class="{active: main.responseBodyFormat == 'pretty'}" title="Show formatted body" ng-click="main.setResponseBodyFormat('pretty')">
                      <span class="icon icon-list"></span> &nbsp;Pretty
                    </button>
                    <button class="btn btn-default" ng-class="{active: main.responseBodyFormat == 'raw'}" title="Show raw body" ng-click="main.setResponseBodyFormat('raw')">
                      <span class="icon icon-tools"></span> &nbsp;Raw
                    </button>
                  </div>
                <div>

              </header>

              <!-- Request data -->
              <code ng-bind-html="main.getFormattedRequest()" ng-if="main.activeTab == 'request' && main.requestBodyFormat == 'pretty'">
              </code>
              <code ng-if="main.activeTab == 'request' && main.requestBodyFormat == 'raw'">
                {{main.selectedRequest.requestText}}
              </code>
              <!-- Response data -->
              <code ng-bind-html="main.getFormattedResponse()" ng-if="main.activeTab == 'response' && main.responseBodyFormat == 'pretty'">
              </code>
              <code ng-if="main.activeTab == 'response' && main.responseBodyFormat == 'raw'">
                {{main.selectedRequest.responseText}}
              </code>
            </div>
          </div>
        </div>
      </div>
    </div>

    <dialog id="editableServerDialog">
        <header class="toolbar toolbar-header">
            <h1 class="title">{{main.dialogMode == 'ADD' ? 'Add New Server' : 'Edit Settings'}}</h1>
        </header>

        <form style="padding: 10px">
          <div class="form-group">
              <label>Name:</label>
              <input type="text" class="form-control" ng-model="main.editableServer.name" placeholder="">
          </div>
          <div class="form-group">
              <label>Remote URL:</label>
              <input type="text" class="form-control" ng-model="main.editableServer.remoteURL" placeholder="http://www.example.com:8080/">
          </div>
          <div class="form-group">
              <label>Local port:</label>
              <input type="text" class="form-control" ng-model="main.editableServer.localPort" placeholder="">
          </div>
        </form>

        <footer class="toolbar toolbar-footer">
            <div class="toolbar-actions">
                <button class="btn btn-primary pull-right" ng-click="main.addNewServer()" ng-if="main.dialogMode == 'ADD'" style="width:50pt">Add</button>
                <button class="btn btn-primary pull-right" ng-click="main.updateServerSettings()" ng-if="main.dialogMode == 'EDIT'" style="width:50pt">Save</button>
                <button class="btn btn-default pull-right" ng-click="main.closeNewServerDialog()" style="width:50pt">Cancel</button>
            </div>
        </footer>
    </dialog>

  </body>
</html>
